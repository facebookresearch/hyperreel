# @package _group_

type: lightfield

render:
  type: lightfield

param:
  n_dims: 6
  fn: identity


### EMBEDDING ###
embedding:
  type: ray_point

  embeddings:
    # 1) Per ray outputs
    ray_prediction_0:
      type: ray_prediction

      # Parameterization
      params:
        ray:
          start: 0
          end: 6

          param:
            n_dims: 6
            fn: two_plane

          pe:
            type: windowed
            n_freqs: 2
            wait_iters: 0
            max_freq_epoch: 0
            exclude_identity: False

      # Net
      net:
        type: base
        group: embedding_impl

        depth: 6
        hidden_channels: 256
        skips: [3]

      # Outputs
      z_channels: 96

      outputs:
        z_vals:
          channels: 1

        sigma:
          channels: 1

          activation:
            type: sigmoid
            fac: 1.0
            shift: 2.0

        point_offset:
          channels: 3

          activation:
            type: tanh
            fac: 0.25

    # 2) Intersection
    ray_intersect_0:
      type: ray_intersect

      # Intersect
      z_channels: 96

      intersect:
        type: z

        sort: True
        outward_facing: False
        use_disparity: False
        use_sigma: False

        initial: -1.0
        end: 1.0
        near: 0.25

        activation:
          type: identity
          fac: 0.5

    # 4) Add point offset
    point_offset_0:
      type: point_offset
      use_sigma: True

    # 5) Add extra outputs
    add_point_outputs_0:
      type: add_point_outputs
      extra_outputs: ['viewdirs']

    # 6) Extract
    extract_fields:
      type: extract_fields
      fields: ['points', 'distances', 'viewdirs', 'weights']


### COLOR ###
color:
  type: base

  net:
    type: tensor_vm_split_no_sample

    # Scene hyper-params
    white_bg: 0
    ndc_ray: 0

    # Density activation
    #fea2denseAct: softplus
    #distance_scale: 25.0
    #density_shift: -10.0
    fea2denseAct: relu
    distance_scale: 4.0
    density_shift: 0.0

    # Grid bounds
    aabb: [[-2.0, -2.0, -2.0], [2.0, 2.0, 2.0]]

    # Grid size and upsampling
    #N_voxel_init: 8000000 # 200**3
    N_voxel_init: 1000000 # 100**3
    N_voxel_final: 64000000 # 400**3
    upsamp_list: [4000,6000,8000,10000,12000]
    lr_upsample_reset: True

    # Thresholding
    #update_AlphaMask_list: []
    update_AlphaMask_list: [4000,8000]
    rm_weight_mask_thre: 1e-4
    alpha_mask_thre: 1e-4

    # Tensor sizes
    n_lamb_sigma: [8,8,8]
    n_lamb_sh: [8,8,8]
    num_frames: 8

    # Shading
    #shadingMode: RGB
    #data_dim_color: 3

    shadingMode: SH
    data_dim_color: 27
